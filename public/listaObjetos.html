<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kebab Simulator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Mouse+Memoirs&display=swap');
        body {
            background-color: #fbf1a9 !important;
            font-family: 'Arial', sans-serif;
        }
        h1 {
            text-align: center;
            font-family: 'Mouse Memoirs', sans-serif;
            margin-top: 50px;
            color: #6c757d;
        }
        #weapons-list {
            padding-left: 0;
        }
        .card {
            border-radius: 15px;
            background-color: #f8d7da;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            color: #495057;
            margin-bottom: 20px;
        }
        .card-body {
            padding: 20px;
        }
        .alert-auto-login {
            margin-top: 20px;
        }
    </style>
</head>
<body>
<h1>Kebab Simulator</h1>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div id="weapons-list" class="list-group">
                <!-- Los datos de las armas se cargarán aquí por el script fetchWeapons.js -->
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div id="message" class="alert alert-info alert-auto-login" style="display: none;">You have been automatically logged in.</div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetchWeapons(); // Siempre tratar de obtener la versión más reciente de las armas
    });

    function fetchWeapons() {
        fetch('/dsaApp/abilities/getAbilities', {
            headers: {
                'Cache-Control': 'no-cache', // Indica al navegador no almacenar la respuesta en caché
                'Pragma': 'no-cache' // Compatibilidad con HTTP/1.0
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                displayWeapons(data); // Mostrar los datos directamente obtenidos del servidor
            })
            .catch(error => {
                console.error('Fetch error:', error);
                alert('Failed to load weapons from server. Please try again later.');
            });
    }

    function displayWeapons(data) {
        const listElement = document.getElementById('weapons-list');
        listElement.innerHTML = '';
        data.forEach(ability => {
            const card = createWeaponCard(ability);
            listElement.appendChild(card);
        });
    }

    function createWeaponCard(ability) {
        const card = document.createElement('div');
        card.className = 'card mb-3';

        const cardBody = document.createElement('div');
        cardBody.className = 'card-body';

        const abilityName = document.createElement('h5');
        abilityName.className = 'card-title';
        abilityName.textContent = ability.abilityName;

        const idAbility = document.createElement('h6');
        idAbility.className = 'card-subtitle mb-2 text-muted';
        idAbility.textContent = `ID: ${ability.idAbility}`;

        const description = document.createElement('p');
        description.className = 'card-text';
        description.textContent = `Description: ${ability.description}`;

        const damage = document.createElement('p');
        damage.className = 'card-text';
        damage.textContent = `Damage: ${ability.damage}`;

        const price = document.createElement('p');
        price.className = 'card-text';
        price.textContent = `Price: $${ability.price}`;

        const buyButton = document.createElement('button');
        buyButton.className = 'btn btn-primary';
        buyButton.textContent = 'Buy';
        buyButton.onclick = function() {
            purchaseItem(ability.idAbility); // Pasar solo el ID de la habilidad
        };

        cardBody.appendChild(abilityName);
        cardBody.appendChild(idAbility);
        cardBody.appendChild(description);
        cardBody.appendChild(damage);
        cardBody.appendChild(price);
        cardBody.appendChild(buyButton);

        card.appendChild(cardBody);
        return card;
    }


    // Verifica si el usuario está autenticado
    document.addEventListener('DOMContentLoaded', function() {
        const userStatus = localStorage.getItem('userStatus');
        if (userStatus !== 'loggedIn') {
            alert('You must be logged in to access this page.');
            window.location.href = '/';
        }

        // Verifica si hay un inicio de sesión automático
        const autoLogin = localStorage.getItem('autoLogin');
        if (autoLogin === 'true') {
            // Muestra el mensaje de inicio de sesión automático
            const message = document.getElementById('message');
            message.style.display = 'block';
            // Limpia el indicador de inicio de sesión automático
            localStorage.removeItem('autoLogin');
        }
    });
</script>
<script src="purchaseItem.js"></script>
</body>
</html>
